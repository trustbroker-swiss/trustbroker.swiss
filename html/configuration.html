<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.22">
<title>Configuration</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
<h1>Configuration</h1>
<div class="details">
<span id="revnumber">version 1.6.0.20240611T152337Z</span>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This section provides insights into the various configurations and their purpose.
All configuration files maintained in a git branch, XTB is started with, are pulled within one minute by a scheduled job.
To speed up experimenting or engineering configurations, run the <code>reconfig.sh</code> script on the side.</p>
</div>
<div class="paragraph">
<p>So the configuration workflow is as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Run XTB with a <code>GIT_URL</code> pointing to your GitOps repository (<code>CONFIG_BRANCH=master</code> is default).</p>
</li>
<li>
<p>Engineer your configuration and push them (the usual git add, commit, push workflow applies).</p>
</li>
<li>
<p>Wait until the console shows the reconfiguration or speed it up using the <code>reconfig.sh</code> script mentioned at the end.</p>
</li>
<li>
<p>Test your changes.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_global_settings">Global Settings</h2>
<div class="sectionbody">
<div class="paragraph">
<p>XTB is a spring-boot microservice running with a builtin application.yml for defaults and a spring.profiles.active=DEMO
activated application.yml from the GitOps repository overriding or completing these defaults.</p>
</div>
<div class="paragraph">
<p>The following annotated demo file shows insights:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">---
server:
  tomcat:
    threads: # scaling
      max: 100
      min-spare: 50
  servlet:
    session:
      cookie:
        name: BSESSION
  ssl:
    enabled: false

spring:
  datasource:
    url: ${spring.flyway.url}/${spring.flyway.schemas}
    username: trustbroker
    password: ${STATECACHE_PASS}
    driverClassName: ${spring.flyway.driver-class-name}
    hikari:
      maximum-pool-size: 30 # we run 3 pods in PROD =&gt; 90 connections max on mariadb (max acceptable is 150 per default)
      connection-timeout: 15000 # DB connection establish timeout in case of network problems (default: 30000ms = 10min)
      minimum-idle: 3 # close connections being idle for idle-timeout except if we have too few afterwards
      idle-timeout: 300000 # maximum connection idle time (default: 600000ms = 10min)
      max-lifetime: 1800000 # maximum connection lifetime in the pool after close (default: 1800000ms = 30min, mariadb has 60min)
      keepalive-time: 600000 # less than max-lifetime using connection-test-query to probe the DB (default: 0ms == disabled)
      connection-test-query: select 1 from dual # probe DB according to keepalive-time
  flyway:
    enabled: true
    url: jdbc:mariadb://mariadb:3306
    user: root
    password: ${STATECACHE_PASS}
    schemas: TBSS16
    driver-class-name: org.mariadb.jdbc.Driver
    locations: [classpath:db/migration/mariadb]
    baselineOnMigrate: true # force upgrading XTB schema even though the database is not empty

trustbroker:
  config:
    issuer: http://localhost:8090 # Issuer ID used to identify assertion/token issuer
    perimeterUrl: ${trustbroker.config.issuer} # Override if network endpoint cannot be derived from issuer ID
    adminSecret: 'trustbroker.config.adminSecret'
    traceIdHeader: X-Request-Id # use edge infrastructure injected HTTP header to correlate all logs belonging to a request
    sessionLifetimeSec: 1800 # 30min user login latency on CP/IDP
    ssoSessionLifetimeSec: 43200 # 12h without re-auth when SSO enabled=true and not SAML forceAuthn=true or OIDC prompt=login
    ssoMinQoaLevel: -2 # we allow SSO for any QOA level sent by CP i.e. unspecified having order# -1 is good enough
    handleResponderErrors: false # Pass through CP/IDP SAML responder messages to CP/SP
    # Support a global signer and the option to read multiple certs from a single keystore (including p12) by picking by name
    signer:
      signerCert: ${TRUSTBROKER_HOME}/configuration/latest/keystore/token-signer/keystore.pem
      password: "${PKI_PASSPHRASE}"
    rolloverSigner:
      signerCert: ${TRUSTBROKER_HOME}/configuration/latest/keystore/token-signer/rollover-keystore.pem
      password: "${PKI_PASSPHRASE}"
    claimsMapping:
      syncSchedule: '0 */1 * * * *' # check for git changes every 1min
    stateCache:
      reapSchedule: '30 * * * * *' # check every 30s for collectable sessions
      reapMaxDelaySec: 25 # randomize actual execution start in multiple instance deployments (K8S replicas)
      targetMaxEntries: 104857 # may number of sessions before garbage collecting the oldest valid ones
      minSessionLifetimeSec: ${trustbroker.config.sessionLifetimeSec}
    secureBrowserHeaders: true # false required for OIDC when XTB runs on http instead of https
    security: # some of the following checks can be configured in RelyingPartySecurityPolicies or ClaimsParty.SecurityPolicies
      tokenLifetimeSec: 3600 # Assertion/Condition/Subject timestamp create/check, override on RP SecurityPolicies.notOnOrAfter
      messageLifetimeSec: 28800 # AuthnRequest/Response/LogoutRequest IssueInstant timestamp check (accepted max)
      notBeforeToleranceSec: -5 # NTP time drift accepted from peer for notBefore timestamps
      notOnOrAfterToleranceSec: 5 # NTP time drift accepted from peer for notOnOrAfter timestamps
      requireSignedAuthnRequest: true # CP/IDP per default expect signed request
      requireSignedResponse: true # CP/IDP per default must sign response
      requireSignedAssertion: true # CP/IDP per default must sign assertion within response
      validateAuthnRequest: true # RP/SP per default must sign request
      validateXmlSchema: true # Peers must comply to SAML protocol schemas pre default
      validateAcs: true # Incoming AssertionConsumerURL is validated against ACWhitelist
      validateRelayState: true # SAML RelayState is required and must match session
      validateAudience: true # SAML audience is matched against XTB issuer if found
      requireAudienceRestriction: false # Non-matching SAML audience results in an error
      validateResponseIssuer: false # SAML response issuer must match ClaimsParty.id (recommended)
      requireSubjectConfirmation: true # SAML responses must contain a SubjectConfirmation element
      validateSubjectConfirmationTimestamp: true # Timestamps must be in range
      validateSubjectConfirmationInResponseTo: true # SAML InResponseTo response attribute must match request ID
      validateRequestIssueInstant: true # Check request IssueInstant timestamp against messageLifeTimeSec
      validateRequestCondition: true # Check Condition before/after timestamps against tokenLifetimeSec and tolerances
      validateResponseIssueInstant: true # Check IssueInstant timestamp against messageLifeTimeSec
      validateAssertionIssueInstant: true # Check IssueInstant timestamp against messageLifeTimeSec
      validateAuthnStatementIssueInstant: true # Check IssueInstant timestamp against messageLifeTimeSec
      doSignAssertions: true # RP/SP responses must contain assertion signed by XTB
      doSignSuccessResponse: true # RP/SP responses must be signed by XTB
      doSignFailureResponse: true # RP/SP responders messages must be signed too
    saml:
      consumerUrl: ${trustbroker.config.perimeterUrl}/api/v1/saml # SAML post protocol endpoint
      artifactResolution:
        serviceUrl: ${trustbroker.config.perimeterUrl}/api/v1/saml/arp # SAML artifact resolution protocol endpoint
        index: 0
        artifactLifetimeSecs: 60
        artifactReapIntervalSecs: 300
        persistentCache: true # store artifacts in sessiondb
        truststore:
          signerCert: ${TRUSTBROKER_HOME}/configuration/latest/keystore/outgoing-tls-trust/truststore.p12
          password: "${PKI_PASSPHRASE}"
    oidc:
      issuer: "${trustbroker.config.issuer}" # iss claim setup
      perimeterUrl: "${trustbroker.config.perimeterUrl}/login/saml2/sso" # XTB OIDC federation forward
      sessionMode: IN_DB # use mariadb for state sharing
      endSessionEndpoint: "${trustbroker.config.oidc.issuer}/logout"
      sessionLifetimeSec: ${trustbroker.config.sessionLifetimeSec}
      sessionCookie: true # set additional tracking cookie for clients to detect session termination
      identityProvider:
        assertionConsumerService: "${trustbroker.config.saml.consumerUrl}"
        responseIssuerId: ${trustbroker.config.issuer}
        signer:
          signerCert: ${trustbroker.config.signer.signerCert}
          password: ${trustbroker.config.signer.password}
          keyEntryId: ${trustbroker.config.signer.keyEntryId}
      samlEncrypt: false # encrypt SAML messages sent from XTB/SAML to XTB/OIDC (more SAMl attributes than OIDC claims
      keySchedule: "0 0 1 * * *" # key rotation daily at 1 am (see spring CronExpression)
      keyExpirationMinutes: 2880 # keys valid for 48 hours (requires clients to fetch keys at least once a day)
      keyDeletionMinutes: 3000 # keys kept 2h longer in the database for debugging
      defaultQoa: "urn:oasis:names:tc:SAML:2.0:ac:classes:unspecified" # fallback for acr_values claims
      # Globally customize /token and /userinfo output dropping technical claims (typ=JWT and iss=issuer we keep for now)
      addTokenClaims: # used on /token endpoint to whitelist OIDC technical claims
        - acr # auth context class refs
        - aud # audience =&gt; client_id and other audiences
        - auth_time # authorize time
        - azp # authorized party =&gt; client_id
        - exp # token expiration
        - iat # token issued at
        - iss # OIDC issuer ID
        - jti # JSON token ID
        - nbf # token valid not before
        - nonce # message only once ID
        - scope # claims selection
        - session_state # OIDC session spec (future)
        - sid # front channel logout session ID
        - typ # keycloak specific token typing
      removeUserInfoClaims: # used in /userinfo endpoint to blacklist OIDC technical claims (i.e. remove them from response)
        - aud
        - auth_time
        - azp
        - exp
        - iat
        - jti
        - nbf
        - nonce
        - scope
        - session_state
        - sid
    gui:
      defaultLanguage: de # XTB supports de,fre,it,en per default
      features:
        - HEADER
        - FOOTER
      buttons:
        - HELP_PANEL # or HELP_LINK
        - LANGUAGE_SHORT # or LANGUAGE_LONG
      themeCookie:
        name: THEME
        defaultValue: default
        values:
          - default
      languageCookie:
        name: LANG
    skinnyHrdTriggers: # MSIE workaround using a hard-coded HRD handling instead of the standard application
      - name: 'User-Agent'
        regex: '.*Trident/7.*'
        value: '/skinnyColHRD.html'

logging:
  level:
    root: INFO
    swiss.trustbroker.script: DEBUG</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_claims_provider_definitions">Claims Provider Definitions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This configuration defines the identification and visual aspects of CPs shown on the HRD screen. HRD (home realm discovery)
provides the means for a user to select from multiple CPs one, where an onboarding was done and an account is available.</p>
</div>
<div class="paragraph">
<p>The HRD screen is not shown, when only one CPs is federated. The definition is necessary anyway.
The DEMO setup uses the SAML mock in 2 instances.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;!-- Define the HRD tiles for the claims parties defined in SetupCP_*.xml --&gt;
&lt;ClaimsProviderDefinitions&gt;
	&lt;ClaimsProvider name="SamlMock-1"
					id="urn:trustbroker.swiss:idp:SAML-MOCK-1"
					img="Tile_SAML-Mock.svg"
					description="saml-mock-1"
					shortcut="SM" color="#11AABB"
	/&gt;
	&lt;ClaimsProvider name="SamlMock-2"
					id="urn:trustbroker.swiss:idp:SAML-MOCK-2"
					img="Tile_SAML-Mock.svg"
					description="saml-mock-2"
					shortcut="SM2" color="#FFAA33"
	/&gt;
	&lt;ClaimsProvider name="SamlMock-2"
					id="urn:trustbroker.swiss:idp:SAML-MOCK-3"
					img="Tile_SAML-Mock-3.svg"
					description="saml-mock-3"
					shortcut="SM2" color="#FFAA33"
	/&gt;
&lt;/ClaimsProviderDefinitions&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_single_sign_on_groups">Single Sign On Groups</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SSO groups provide a means to join multiple relying parties into a single login group during a period defined by the group. A
login with the same CP is then not required anymore.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;!--
Define SSO groups and their lifecycle to join multiple relying parties into a single per CP login session:
- name: SSO group name used in RelyingParty.SSO element
- maxIdleTimeMinutes: Time until the SSO session expires without any interaction from any SSO participants
- maxSessionTimeMinutes: Time until the SSO session expires unconditionally
- maxCachingTimeMinutes: Set this one to the same value as maxSessionTimeMinutes (future feature may be)
--&gt;
&lt;SSOGroupSetup&gt;
	&lt;SSOGroup name="SSO-GROUP-1"
			  maxIdleTimeMinutes="120"
			  maxSessionTimeMinutes="600"
			  maxCachingTimeMinutes="600"
	/&gt;
&lt;/SSOGroupSetup&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_claims_party_setup">Claims Party Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The SetupCP.xml defines the technical association with an CP.
It&#8217;s id must match the one in the <code>ClaimsProviderDefinition.xml</code>.
A trust anchor is required because SAML responses from an CP must be signed.
Assertion signing is optional but recommended.
The incoming assertion attributes are declared to also document the expected input from the CP.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;ClaimsProviderSetup&gt;
    &lt;ClaimsParty id="urn:trustbroker.swiss:idp:SAML-MOCK-1" &gt;
        &lt;SSOUrl&gt;http://localhost:7070/auth/saml2/idp/samples&lt;/SSOUrl&gt;
        &lt;Certificates&gt;
            &lt;SignerTruststore&gt;
                &lt;CertPath&gt;token-signer/keystore.pem&lt;/CertPath&gt;
                &lt;Password&gt;$PKI_PASSPHRASE&lt;/Password&gt;
            &lt;/SignerTruststore&gt;
        &lt;/Certificates&gt;
        &lt;Saml&gt;
            &lt;ArtifactBinding inboundMode="SUPPORTED" outboundMode="SUPPORTED"/&gt;
        &lt;/Saml&gt;
        &lt;!-- CP attributes to be propagated --&gt;
        &lt;AttributesSelection&gt;
            &lt;Definition name="EMail" namespaceUri="http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress"/&gt;
            &lt;Definition name="FirstName" namespaceUri="http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname"/&gt;
            &lt;Definition name="FamilyName" namespaceUri="http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname"/&gt;
        &lt;/AttributesSelection&gt;
    &lt;/ClaimsParty&gt;
&lt;/ClaimsProviderSetup&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_relying_party_profile">Relying Party Profile</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Profiles provide a mechanism to declare a template for multiple relying parties using the same protocols, claims definitions
and mapping procedures.</p>
</div>
<div class="paragraph">
<p>The content of a ReylingParty declared in here needs to be correctly ordered according to the configuration schema (see
<code>ReylingParty.java</code> or the XSD files in the docker image).</p>
</div>
<div class="paragraph">
<p>The order reflects the processing model (see architecture) so reading a ProfileRP or SetupRP top down reflects which elements
are used when processing the federation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Input validation (issuer/client IDs, signatures using truststore, security policies affecting request processing)</p>
</li>
<li>
<p>Handling protocols (Saml, Oidc sections)</p>
</li>
<li>
<p>Applying XTB features (like SSO)</p>
</li>
<li>
<p>Dispatching towards CPs using ClaimsProviderMappings</p>
</li>
<li>
<p>On response from CP apply CP AttributesSelection filtering</p>
</li>
<li>
<p>Invoke IDM service applying list of configured IDMQuery (not shown in OSS yet)</p>
</li>
<li>
<p>On response to RP apply UserDetailsSelection (IDM source), PropertiesSelection (computed by scripts)  and ClaimsSelection (towards OIDC) filtering</p>
</li>
<li>
<p>Scripts affect the overall processing and are last</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;!-- A base profile defines defaults used by all RelyingParty setups referring to it --&gt;
&lt;RelyingParty&gt;
	&lt;Certificates&gt;
		&lt;!-- Signer towards all RPs --&gt;
		&lt;SignerKeystore&gt;
			&lt;CertPath&gt;token-signer/keystore.pem&lt;/CertPath&gt;
			&lt;Password&gt;$PKI_PASSPHRASE&lt;/Password&gt;
		&lt;/SignerKeystore&gt;
		&lt;!-- Fallback: We only trust ourselves --&gt;
		&lt;SignerTruststore&gt;
			&lt;CertPath&gt;token-signer/keystore.pem&lt;/CertPath&gt;
			&lt;Password&gt;$PKI_PASSPHRASE&lt;/Password&gt;
		&lt;/SignerTruststore&gt;
	&lt;/Certificates&gt;
	&lt;SecurityPolicies
			notOnOrAfterSeconds="3600"
			requireSignedAuthnRequest="true"
			requireSignedLogoutRequest="true"
			validateXmlSchema="true"
	/&gt;
	&lt;Oidc&gt;
		&lt;Client id="template"&gt;
			&lt;!-- Access restrictions (development only) --&gt;
			&lt;RedirectUris&gt;
				&lt;ACUrl&gt;https://oidcdebugger.com/debug&lt;/ACUrl&gt;
				&lt;ACUrl&gt;http://localhost:0/.*&lt;/ACUrl&gt;
			&lt;/RedirectUris&gt;
			&lt;!-- PKCE code flow with requireProofKey=true and client authentication none --&gt;
			&lt;OidcSecurityPolicies
					requireProofKey="true"
					tokenTimeToLiveMin="60"
					refreshTokenTimeToLiveMin="60"
			/&gt;
			&lt;!-- Supported subset of https://openid.net/specs/openid-connect-core-1_0.html#TokenRequest --&gt;
			&lt;AuthorizationGrantTypes&gt;
				&lt;GrantType&gt;authorization_code&lt;/GrantType&gt;
				&lt;GrantType&gt;client_secret_post&lt;/GrantType&gt;
				&lt;GrantType&gt;refresh_token&lt;/GrantType&gt;
			&lt;/AuthorizationGrantTypes&gt;
			&lt;!-- Supported subset of https://openid.net/specs/openid-connect-core-1_0.html#ClientAuthentication --&gt;
			&lt;ClientAuthenticationMethods&gt;
				&lt;Method&gt;none&lt;/Method&gt;
				&lt;Method&gt;client_secret_basic&lt;/Method&gt;
				&lt;Method&gt;client_secret_post&lt;/Method&gt;
			&lt;/ClientAuthenticationMethods&gt;
			&lt;!-- Scopes see https://openid.net/specs/openid-connect-core-1_0.html#ScopeClaims --&gt;
			&lt;Scopes&gt;
				&lt;Scope&gt;openid&lt;/Scope&gt;
				&lt;Scope&gt;profile&lt;/Scope&gt;
				&lt;Scope&gt;email&lt;/Scope&gt;
			&lt;/Scopes&gt;
			&lt;!-- Claims see at https://openid.net/specs/openid-connect-core-1_0.html#StandardClaims --&gt;
			&lt;ClaimsSelection&gt;
				&lt;Definition name="EMail" namespaceUri="http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress"
							oidcNames="email" multiValued="STRING" /&gt;
				&lt;Definition name="FirstName" namespaceUri="http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname"
							oidcNames="given_name" /&gt;
				&lt;Definition name="Name" namespaceUri="http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname"
							oidcNames="family_name" /&gt;
				&lt;Definition name="dateOfBirth" namespaceUri="http://schemas.xmlsoap.org/ws/2005/05/identity/claims/dateofbirth"
							oidcNames="birthdate" multiValued="STRING" oidcMapper="TIME_EPOCH" /&gt;
				&lt;Definition name="address" namespaceUri="address"
							oidcNames="address" /&gt;
				&lt;Definition name="displayName" namespaceUri="2.16.840.1.113730.3.1.241"
							oidcNames="name" multiValued="LIST" /&gt;
				&lt;Definition name="displayName" namespaceUri="2.16.840.1.113730.3.1.241"
							oidcNames="name" multiValued="LIST" /&gt;
			&lt;/ClaimsSelection&gt;
		&lt;/Client&gt;
	&lt;/Oidc&gt;
	&lt;Saml&gt;
		&lt;ArtifactBinding inboundMode="SUPPORTED" outboundMode="SUPPORTED" /&gt;
		&lt;!-- XML security defaults according to https://www.w3.org/TR/xmlsec-algorithms/ --&gt;
		&lt;Signature&gt;
			&lt;CanonicalizationAlgorithm&gt;http://www.w3.org/2001/10/xml-exc-c14n#&lt;/CanonicalizationAlgorithm&gt;
			&lt;SignatureMethodAlgorithm&gt;http://www.w3.org/2001/04/xmldsig-more#rsa-sha256&lt;/SignatureMethodAlgorithm&gt;
			&lt;DigestMethod&gt;http://www.w3.org/2001/04/xmlenc#sha256&lt;/DigestMethod&gt;
		&lt;/Signature&gt;
	&lt;/Saml&gt;
	&lt;!-- SSO also is used in disabled mode so XTB knows where to send the LogoutResponse to --&gt;
	&lt;SSO enabled="false" sloUrl="please-define-if-rp-does-saml-logouts" /&gt;
	&lt;!-- Processing: Accepted incoming original issuer attributes --&gt;
	&lt;AttributesSelection&gt;
		&lt;Definition name="EMail" namespaceUri="http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress" /&gt;
		&lt;Definition name="FirstName" namespaceUri="http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname" /&gt;
		&lt;Definition name="FamilyName" namespaceUri="http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname" /&gt;
		&lt;Definition name="dateOfBirth" namespaceUri="http://schemas.xmlsoap.org/ws/2005/05/identity/claims/dateofbirth"/&gt;
		&lt;Definition name="displayName" namespaceUri="2.16.840.1.113730.3.1.241"/&gt;
		&lt;!-- CP is visible only in SAML OriginalIssuer in RP response. Make it visible as an OIDC claim. --&gt;
		&lt;Definition name="HomeRealmHint" namespaceUri="HomeRealmHint" oidcNames="homerealmhint"/&gt;
	&lt;/AttributesSelection&gt;
	&lt;!-- Processing: Attributes computed in groovy scripts. It's possible to use oidcNames declarations already on any selection definition. --&gt;
	&lt;PropertiesSelection&gt;
		&lt;!-- Computed birthdate can be picked exclusively (remove from AttributesSelection above, or in the groovy script. --&gt;
		&lt;Definition name="displayName" namespaceUri="2.16.840.1.113730.3.1.241" oidcNames="name" multiValued="LIST" /&gt;
		&lt;!-- ssoSessionId is an XTB specific claim that allows to identify the federation session source --&gt;
		&lt;Definition name="ssoSessionId" namespaceUri="http://trustbroker.swiss/claims/ssoSessionId" oidcNames="ssoSessionId" /&gt;
	&lt;/PropertiesSelection&gt;
	&lt;!-- Processing: All RP side hooks dumping provided request/response data --&gt;
	&lt;Scripts&gt;
		&lt;Script type="BeforeHrd"&gt;DebugRpRequest.groovy&lt;/Script&gt;
		&lt;Script type="BeforeIdm"&gt;DebugCpResponse.groovy&lt;/Script&gt;
		&lt;Script type="AfterIdm"&gt;DebugCpResponse.groovy&lt;/Script&gt;
		&lt;Script type="OnToken"&gt;DebugCpResponse.groovy&lt;/Script&gt;
		&lt;Script type="OnUserInfo"&gt;DebugCpResponse.groovy&lt;/Script&gt;
	&lt;/Scripts&gt;
&lt;/RelyingParty&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_relying_party_setup">Relying Party Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>SetupRP.xml</code> defines the federation with the SAML service provider or OIDC application client based on the <code>ProfileRP.xml</code> it
refers to.</p>
</div>
<div class="paragraph">
<p>The profile is optional but recommended to reduce bad copy&amp;paste habits and maintain site policies within few profiles.
The merging is done at startup or when a git configuration change is detected.
Broken configurations are ignored for resilience.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;!-- relying party setup showing the basics of non-SSO usage --&gt;
&lt;RelyingPartySetup&gt;
    &lt;RelyingParty id="urn:trustbroker.swiss:sp:DEMO-RP-1" base="ProfileRP_DemoDefaults.xml"&gt;
        &lt;ACWhitelist&gt;
            &lt;ACUrl&gt;http://localhost:7070/authn/consumer&lt;/ACUrl&gt;
        &lt;/ACWhitelist&gt;
        &lt;Saml&gt;
            &lt;ProtocolEndpoints&gt;
                &lt;MetadataUrl&gt;http://localhost:7070/saml/metadata&lt;/MetadataUrl&gt;
                &lt;ArtifactResolutionUrl&gt;http://localhost:7070/authn/arp&lt;/ArtifactResolutionUrl&gt;
                &lt;ArtifactResolutionIndex&gt;0&lt;/ArtifactResolutionIndex&gt;
            &lt;/ProtocolEndpoints&gt;
            &lt;ArtifactBinding inboundMode="SUPPORTED" outboundMode="SUPPORTED"/&gt;
        &lt;/Saml&gt;
        &lt;SSO enabled="false" sloUrl="http://localhost:7070/auth/saml/slo"/&gt;
        &lt;ClaimsProviderMappings&gt;
            &lt;ClaimsProvider id="urn:trustbroker.swiss:idp:SAML-MOCK-1" /&gt;
            &lt;ClaimsProvider id="urn:trustbroker.swiss:idp:SAML-MOCK-2" /&gt;
            &lt;ClaimsProvider id="urn:trustbroker.swiss:idp:SAML-MOCK-3" /&gt;
            &lt;!-- invisible but addressable CP, remove the previous entry to make SAML-MOCK-3 invisible on the HRD screen --&gt;
            &lt;ClaimsProvider id="urn:trustbroker.swiss:idp:SAML-MOCK-3" relyingPartyAlias="urn:trustbroker.swiss:sp:DEMO-RP-3"/&gt;
        &lt;/ClaimsProviderMappings&gt;
        &lt;Scripts&gt;
            &lt;Script type="BeforeHrd"&gt;HrdAutoSelectClaimsProvider.groovy&lt;/Script&gt;
            &lt;Script type="AfterIdm"&gt;ComputeDerivedAttributes.groovy&lt;/Script&gt;
        &lt;/Scripts&gt;
    &lt;/RelyingParty&gt;
&lt;/RelyingPartySetup&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pki_setup">PKI Setup</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_oidc">OIDC</h3>
<div class="paragraph">
<p>OIDC uses automatically generated keys that are rotated (per default) weekly.</p>
</div>
<div class="paragraph">
<p>Clients not checking the JWKS endpoint:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>when the kid claim in the header does not match the local key set.</p>
</li>
<li>
<p>periodically but at least once a week</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>might run into JWT signature verification problems.
Key rotation settings need to be tuned in this case in the global configuration (see above).
It&#8217;s recommended to fix the client instead.</p>
</div>
</div>
<div class="sect2">
<h3 id="_saml">SAML</h3>
<div class="paragraph">
<p>XTB supports various keystore formats, but we recommend the first 2:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>keystore.pem</code>: OpenSSL PEM formatted certificate along with the private RSA key, protected by the PKI_PASSPHRASE from the
runtime environment (K8S secret, CO vault)</p>
</li>
<li>
<p><code>truststore.pem</code>: The same but no private key in their. This one instead might contain multiple trusted certificates (e.g. when
the peer is in the process of replacing its signer)</p>
</li>
<li>
<p><code>keystore.p12</code>: PKCS12 keystores with or without private keys.</p>
</li>
<li>
<p><code>keystore.jks</code>: Java keystores are fast but not recommended, use one of the other formats.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Tools to work with keystores:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>openssl</p>
</li>
<li>
<p>keytool (mainly to read JKS and transfer private keys into PKCS12 files for openssl handling)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please check the installation documentation for signer generation.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_groovy_scripts">Groovy Scripts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Setup and profile configurations can refer to groovy scripts to customize federation data and flow.
Check the scripting section for insights.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ui_setup">UI Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>XTB has a small frontend for various purposes, mainly HRD (see above) and error display.</p>
</div>
<div class="paragraph">
<p>The following can be customized:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>config: The global settings contain a few UI influencing settings (e.g. the site specific language cookie, if the browser
language shall be overruled)</p>
</li>
<li>
<p>translations: Texts for languages <code>de</code>, <code>fr</code>, <code>en</code> and <code>it</code>.</p>
</li>
<li>
<p>images: The tile images used on the HRD screen and declared in the ClaimsProviderDefinition.xml (see above)</p>
</li>
<li>
<p>assets: The theme resources to provide a corporate identity (icons, style, logo)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Text handling:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Text keys can be found in <code>trustbroker-frontend/src</code> (look for the ng translate items).</p>
</li>
<li>
<p>Texts are maintained in texts.json for convenience and can be exchanged as texts.csv for translation services.</p>
</li>
<li>
<p>The <code>text2json.py</code> script checks the maintained master file and generates the derived <code>de/fr/en/it.json</code> translations.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_theme_customizing">Theme Customizing</h3>
<div class="paragraph">
<p>See <code>xtb-gitops-demo</code> for assets and check the CSS to see if the styling of the interactive parts of XTB (usually HRD and
error screen) fits your needs.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reconfiguration_process">Reconfiguration Process</h2>
<div class="sectionbody">
<div class="paragraph">
<p>On first time use the repository is cloned into the <code>configCache</code>.</p>
</div>
<div class="paragraph">
<p>XTB from then on checks the GitOps repository for changes and if commits are detected:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>git pull the changes in <code>configCache</code></p>
</li>
<li>
<p>copy the selected stage profile into configuration/new</p>
</li>
<li>
<p>validate the configuration</p>
</li>
<li>
<p>if ok activate the configuration by swapping latest configuration into the previous one and the new one takes its place.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This allows to diff latest against previous to see what changed.
Changes are also <code>INFO</code> logged in the console.</p>
</div>
<div class="paragraph">
<p>During development the following script speeds up the re-configuration process:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>#!/bin/bash
# Script allows to speed up the configuration loading on XTB.

PERIOD=${1:-5}
while [ true ]; do
	curl -k -X POST http://localhost:8090/api/v1/config \
	     -H 'Content-Type: application/json' \
	     -d '{"action":"reload","adminSecret":"trustbroker.config.adminSecret"}'
	sleep $PERIOD
done</pre>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.6.0.20240611T152337Z<br>
Last updated 2024-06-06 09:22:09 +0200
</div>
</div>
</body>
</html>